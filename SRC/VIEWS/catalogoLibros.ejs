
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/CSS/index.style.css">
    <link rel="stylesheet" href="/CSS/catalogoLibros.style.css">
    <link rel="icon" href="/upload/icon-bg.png" type="imagen/png">
    <title>CATALOGO</title>
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <img src="/upload/icon-bg.png" alt="Logo" class="logo-img">
                <div class="logo-text">
                    <span>MI BIBLIOTECA</span>
                    <p>Braulio Gonzalez</p>
                </div>
            </div>
            
            <ul class="nav-links">
                <li><a href="/"><img src="/upload/home_icon-bg_black.png" >inicio</a></li>
                <li><a href="/catalogoLibros"><img src="/upload/catalogo_book_icon.png" >catalogo</a></li>
                 <!--opciones administrador-->
                 <% if (user && user.rol === 'admin') { %>
                 <li>
                    <select name="administrar" id="opcionAdmin">
                        <option value="">administrar</option>
                        <option value="/registrarLibro">registrar libro</option>
                        <option value="/prestamos">Pr√©stamos</option>
                        <option value="/usuarios">Usuarios</option>
                    </select>
                </li>
                <% } else { %>
                <li>
                    <a href="prestamos"><img src="/upload/prestamo_usr_icon.png" >Mis pr√©stamos</a>
                </li>
                
                <% } %>

                
                <!--modal perfil-->
                <li><button class="modal_perfil-btn" id="btnPerfil"><img src="/upload/usr_login_icon.png" ></button></li>
                <div class="modal-perfil" id="modalPerfil">
                    <div class="modal-content-perfil">
                        <span class="close-btn" id="closeBtn">&times;</span>
                        
                        <% if (user) { %>
                            <div class="user-info">
                                <h3>Perfil de Usuario</h3>
                                <div class="user-details">
                                    <p><strong>Nombre:</strong> <%= user.nombre || 'No disponible' %></p>
                                    <% if (user.num_documento) { %>
                                        <p><strong>Documento:</strong> <%= user.num_documento %></p>
                                    <% } %>
                                    <p><strong>Email:</strong> <%= user.email || 'No disponible' %></p>
                                    <p><strong>Rol:</strong> <%= user.rol || 'No definido' %></p>
                                    <% if (user.rol === 'estudiante' && (user.grado || user.curso)) { %>
                                        <p><strong>Grado:</strong> <%= (user.grado || '') %><%= user.grado && user.curso ? ' - ' : '' %><%= (user.curso || '') %></p>
                                    <% } %>
                                </div>
                            </div>
                            <a href="/logout" class="btn-logout">
                                <img src="/upload/cerrar-session_icon.png" alt="logout">
                                Cerrar Sesi√≥n
                            </a>
                        <% } else { %>
                            <div class="user-info">
                                <h3>Acceso Requerido</h3>
                                <p>No has iniciado sesi√≥n.</p>
                            </div>
                            <a href="/login" class="btn-iniciar-sesion">Iniciar Sesi√≥n</a>
                        <% } %>
                        
                    </div>
                </div>
               
                
                
            </ul>
            <!--menu_movil-->
            <div class="menu-movil" id="menuMovil">
                <button id="btnPerfilMobile" class="modal_perfil-btn btn-perfil-mobile" aria-label="Perfil"><img src="/upload/usr_login_icon.png" alt="perfil"></button>
                <button id="btnMenuMobile"><img src="/upload/menu_icon.png" alt="menu-img"></button>
                <div class="menu-content">
                    <div class="bar1">
                        <a href="/"><img src="/upload/home_icon-bg_black.png" alt="home-img">Inicio</a>
                    </div>
                    <div class="bar2">
                        <a href="/catalogoLibros"><img src="/upload/catalogo_book_icon.png" alt="catalogo-img">Cat√°logo</a>
                        <% if (user && user.rol === 'admin') { %>
                            <a href="/registrarLibro"><img src="/upload/new_libro_icon.png" alt="libro-img">Registrar Libro</a>
                            <a href="/prestamos"><img src="/upload/prestamo_usr_icon.png" alt="prestamo-img">Pr√©stamos</a>
                            <a href="/usuarios"><img src="/upload/user_ver_icon.png" alt="usr-img">Usuarios</a>
                        <% } else if (user) { %>
                            <a href="/prestamos"><img src="/upload/prestamo_usr_icon.png" alt="prestamo-img">Mis Pr√©stamos</a>
                        <% } %>
                    </div>
                    <div class="bar3">
                        <% if (user) { %>
                            <a href="/logout" class="btn-logout-movil"><img src="/upload/cerrar-session_icon.png" alt="logaut-img">Cerrar Sesi√≥n</a>
                        <% } else { %>
                            <a href="/login" class="btn-iniciar-sesion-movil">Iniciar Sesi√≥n</a>
                        <% } %>
                    </div>
                </div>
            </div>
        </nav>
    </header>
    <main>
        
        <h1>NUESTRO CATALOGO</h1>
        
        <!-- Mostrar mensajes de √©xito o error -->
        <% if (typeof success !== 'undefined' && success) { %>
            <div class="alert alert-success">
                <span>‚úÖ <%= success %></span>
            </div>
        <% } %>
        
        <% if (typeof error !== 'undefined' && error) { %>
            <div class="alert alert-error">
                <span>‚ùå <%= error %></span>
            </div>
        <% } %>
        <!-- Formulario de b√∫squeda -->
        <div class="search-container">
            
            <form action="/buscar" method="GET" class="search-form">
                
                <input type="search" name="q" id="buscador" placeholder="Buscar por nombre ,autor o categoria..." 
                    value="<%= typeof terminoBusqueda !== 'undefined' ? terminoBusqueda : '' %>" >
                <button type="submit" id="btn-buscar">Buscar</button>
            </form>
        </div>
        <!-- Mostrar t√©rmino de b√∫squeda si existe -->
        <% if (typeof terminoBusqueda !== 'undefined' && terminoBusqueda) { %>
            <div class="search-results">
                <p>Resultados para: "<%= terminoBusqueda %>"</p>
                <a href="/catalogoLibros" class="clear-search">Limpiar b√∫squeda</a>
            </div>
        <% } %>
        <form action="/catalogoLibros" method="post">
            <% if(libros && libros.length > 0){%>
                <div class="libros-grid">
                    <% libros.forEach(libro =>{ %>
                        <div class="libro-card">
                            <a href="infolibro/<%= libro.id_libro %>">
                                <div class="libro-imagen">
                                <% if (libro.imagen) { %>
                                    <img src="/upload/<%= libro.imagen %>" alt="<%= libro.nombre %>" >
                                <% } else { %>
                                    <div class="placeholder-imagen">
                                        <span>üìö</span>
                                    </div>
                                <% } %> 
                            </div>
                            <div class="libro-info">
                                <h3 class="libro-titulo"><%= libro.nombre %></h3>
                                <p class="libro-autor">por <%= libro.autor %></p>
                                <div class="libro-details">
                                    <span class="libro-categoria"><%= libro.categoria %></span>
                                    <span class="libro-cantidad">Stock: <%= libro.cantidad %></span>
                                </div>
                            </div>
                            </a>
                            
                            <div class="libro-acciones">
                                    <% if (user && user.rol === 'admin') {%>
                                        <a href="/editar/<%= libro.id_libro %>" class="btn-editar"><img src="/upload/edit_icon.png" alt="edit-img">EDITAR</a>
                                        
                                        <button class="btn-eliminar-trigger" data-libro-id="<%= libro.id_libro %>" data-libro-nombre="<%= libro.nombre %>">
                                            <img src="/upload/delete_icon.png" alt="delete-img">ELIMINAR
                                        </button>
                                        
                                        <div class="modal-eliminar_libro" style="display: none;">
                                            <div class="modal-content-eliminar">
                                                <span class="close-btn-eliminar">&times;</span>
                                                <p>¬øEst√°s seguro de eliminar el libro <strong><%= libro.nombre %></strong>?</p>
                                                <form action="/eliminar/<%= libro.id_libro %>" method="post">
                                                    <button type="submit" class="btn-eliminar-confirm">ACEPTAR</button>
                                                    <button type="button" class="btn-cancelar">CANCELAR</button>
                                                </form>
                                            </div>
                                        </div>
                                    <%}else {%>
                                        
                                    <%} %>
                            </div>
                        </div>
                    <% }); %>
                </div>
            <% } else { %>
                <% if (typeof terminoBusqueda !== 'undefined' && terminoBusqueda) { %>
                    <div class="no-results">
                        <p>No se encontraron libros que coincidan con "<%= terminoBusqueda %>"</p>
                        <a href="/" class="back-to-all">Ver todos los libros</a>
                    </div>
                <% } else { %>
                    <p>No hay libros registrados</p>
                <% } %>
            <% } %>
        </div>
        </form>
    </main>
    <footer>
        <div class="footer-content">
            <div   class="logo-footer">
                <img src="/upload/icon-bg.png" alt="Logo" class="logo-img-footer">
                <div class="logo-text-footer">
                    <span>MI BIBLIOTECA</span>
                    <p>Braulio Gonzalez</p>
                </div>
            </div>
            <div class="social-media">
                <a href="https://www.facebook.com/profile.php?id=61555954465668" ><img src="/upload/facebook_icon.png" alt="Facebook"></a>
                <a href="https://www.brauliogonzalez.edu.co/"><img src="/upload/internet_icon.png" alt="sitioWebPrincipal"></a>
                <a href="https://www.tiktok.com/@modsistemasbg?_t=ZS-8zVUt52WxG6&_r=1"><img src="/upload/tik-tok_icon.png" alt="tiktok"></a>
            </div>
            <p>&copy; 2024 Biblioteca ColBraulio. Todos los derechos reservados.</p>
        </div>

    </footer>
    <script src="/JS/base.script.js"></script>
    <script src="/JS/catalogoLibro.script.js"></script>
</body>
</html>