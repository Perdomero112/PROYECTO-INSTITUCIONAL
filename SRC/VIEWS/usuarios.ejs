<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/CSS/index.style.css">
    <link rel="stylesheet" href="/CSS/tables.style.css">
    <link rel="stylesheet" href="/CSS/usuario.style.css">
    <link rel="icon" href="/upload/icon-bg.png" type="imagen/png">
    <title>USUARIOS</title>
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <img src="/upload/icon-bg.png" alt="Logo" class="logo-img">
                <div class="logo-text">
                    <span>MI BIBLIOTECA</span>
                    <p>Braulio Gonzalez</p>
                </div>
            </div>
            
            <ul class="nav-links">
                <li><a href="/"><img src="/upload/home_icon-bg_black.png" >inicio</a></li>
                <li><a href="/catalogoLibros"><img src="/upload/catalogo_book_icon.png" >catalogo</a></li>
                 
                
                 <li>
                    <select name="administrar" id="opcionAdmin">
                        <option value="">administrar</option>
                        <option value="/registrarLibro">registrar libro</option>
                        <option value="/prestamos">Préstamos</option>
                        <option value="/usuarios">Usuarios</option>
                    </select>
                </li>
                

                
                <!--modal perfil-->
                <li><button class="modal_perfil-btn" id="btnPerfil"><img src="/upload/usr_login_icon.png" ></button></li>
                <div class="modal-perfil" id="modalPerfil">
                    <div class="modal-content-perfil">
                        <span class="close-btn" id="closeBtn">&times;</span>
                        
                        <% if (user) { %>
                            <div class="user-info">
                                <h3>Perfil de Usuario</h3>
                                <div class="user-details">
                                    <p><strong>Nombre:</strong> <%= user.nombre || 'No disponible' %></p>
                                    <% if (user.num_documento) { %>
                                        <p><strong>Documento:</strong> <%= user.num_documento %></p>
                                    <% } %>
                                    <p><strong>Email:</strong> <%= user.email || 'No disponible' %></p>
                                    <p><strong>Rol:</strong> <%= user.rol || 'No definido' %></p>
                                    <% if (user.rol === 'estudiante' && (user.grado || user.curso)) { %>
                                        <p><strong>Grado:</strong> <%= (user.grado || '') %><%= user.grado && user.curso ? ' - ' : '' %><%= (user.curso || '') %></p>
                                    <% } %>
                                </div>
                            </div>
                            <a href="/logout" class="btn-logout">
                                <img src="/upload/cerrar-session_icon.png" alt="logout">
                                Cerrar Sesión
                            </a>
                        <% } else { %>
                            <div class="user-info">
                                <h3>Acceso Requerido</h3>
                                <p>No has iniciado sesión.</p>
                            </div>
                            <a href="/login" class="btn-iniciar-sesion">Iniciar Sesión</a>
                        <% } %>
                        
                    </div>
                </div>
               
                
                
            </ul>
            <!--menu_movil-->
            <div class="menu-movil" id="menuMovil">
                <button id="btnPerfilMobile" class="modal_perfil-btn btn-perfil-mobile" aria-label="Perfil"><img src="/upload/usr_login_icon.png" alt="perfil"></button>
                <button><img src="/upload/menu_icon.png" alt="menu-img"></button>
                <div class="menu-content">
                    <div class="bar1">
                        <a href="/"><img src="/upload/home_icon-bg_black.png" alt="home-img">Inicio</a>
                    </div>
                    <div class="bar2">
                        <a href="/catalogoLibros"><img src="/upload/catalogo_book_icon.png" alt="catalogo-img">Catálogo</a>
                        <% if (user && user.rol === 'admin') { %>
                            <a href="/registrarLibro"><img src="/upload/new_libro_icon.png" alt="libro-img">Registrar Libro</a>
                            <a href="/prestamos"><img src="/upload/prestamo_usr_icon.png" alt="prestamo-img">Préstamos</a>
                            <a href="/usuarios"><img src="/upload/user_ver_icon.png" alt="usr-img">Usuarios</a>
                        <% } else if (user) { %>
                            <a href="/mis-prestamos"><img src="/upload/prestamo_usr_icon.png" alt="prestamo-img">Mis Préstamos</a>
                        <% } %>
                    </div>
                    <div class="bar3">
                        <% if (user) { %>
                            <a href="/logout" class="btn-logout-movil"><img src="/upload/cerrar-session_icon.png" alt="logaut-img">Cerrar Sesión</a>
                        <% } else { %>
                            <a href="/login" class="btn-iniciar-sesion-movil">Iniciar Sesión</a>
                        <% } %>
                    </div>
                </div>
            </div>
        </nav>
    </header>
    <main>
        <div class="usuarios-container">
        <div class="usuarios-table-container">
        <table class="usuarios-table">
            <thead>
                <td>ID USUARIO</td>
                <td>DOCUMENTO</td>
                <td>NOMBRE</td>
                <% if (user && user.rol === 'estudiante') { %>
                <td>GRADO</td>
                <% } %>                                 
                <td>TELEFONO</td>
                <td>EMAIL</td>
                <td>ROL</td>
                <td>ACCIONES</td>
            </thead>
            <tbody>
                <% users.forEach(usuario => { %>  
                <tr>
                    <td><%= usuario.id_usr %></td>
                    <td><%= usuario.docum_usr %></td>
                    <td><%= usuario.nombre_usr %></td>
                    <% if (user && user.rol === 'estudiante') { %>
                    <td><%= usuario.grado_std %></td>
                    <% } %>
                    <td><%= usuario.telefono_usr %></td>
                    <td><%= usuario.gmail_usr %></td>
                    <td><%= usuario.rol %></td>
                    <td>
                        <a href="/usuarios/<%= usuario.id_usr %>"><img src="/upload/edit_icon.png" alt="editar"></a>
                        <a href="/usuarios/<%= usuario.id_usr %>"><img src="/upload/delete_icon.png" alt="eliminar"></a>
                    </td>
                </tr>
                <% }) %>
            </tbody>
        </table>
        </div>
        </div>
        <!-- Cards móviles (USUARIOS) -->
        <div class="cards-list usuarios-cards">
            <% if (Array.isArray(users) && users.length) { %>
                <% users.forEach(usuario => { %>
                    <div class="card">
                        <div class="card-row"><span class="card-label">ID</span><span class="card-value"><%= usuario.id_usr %></span></div>
                        <div class="card-row"><span class="card-label">Documento</span><span class="card-value"><%= usuario.docum_usr %></span></div>
                        <div class="card-row"><span class="card-label">Nombre</span><span class="card-value"><%= usuario.nombre_usr %></span></div>
                        <% if (user && user.rol === 'estudiante') { %>
                        <div class="card-row"><span class="card-label">Grado</span><span class="card-value"><%= usuario.grado_std %></span></div>
                        <% } %>
                        <div class="card-row"><span class="card-label">Teléfono</span><span class="card-value"><%= usuario.telefono_usr %></span></div>
                        <div class="card-row"><span class="card-label">Email</span><span class="card-value"><%= usuario.gmail_usr %></span></div>
                        <div class="card-row"><span class="card-label">Rol</span><span class="card-value"><%= usuario.rol %></span></div>
                        <div class="card-actions">
                            <a class="btn-editar" href="/usuarios/<%= usuario.id_usr %>"><img src="/upload/edit_icon.png" alt="editar"></a>
                            <a class="btn-eliminar" href="/usuarios/<%= usuario.id_usr %>"><img src="/upload/delete_icon.png" alt="eliminar"></a>
                        </div>
                    </div>
                <% }); %>
            <% } else { %>
                <div class="card empty">No hay usuarios disponibles</div>
            <% } %>
        </div>
    </main>
    <script src="/JS/base.script.js"></script>
    <script src="/JS/usuarios.script.js"></script>
</body>
</html>